<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bank Clerk Endless Training Game</title>
  <style>
    body { margin:0; font-family:"Segoe UI",Arial; height:100vh; display:flex; background:#eff3f7; }
    .hidden { display:none; }

    /* Instructions overlay */
    #instructions {
      flex:1;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      background:#2cb742;
      color:white;
      padding:40px;
      font-size:16px;
      text-align:left;
    }
    #instructions h1 { font-size:28px; margin-bottom:20px; }
    #instructions ul { max-width:600px; text-align:left; }
    #instructions button {
      margin-top:20px;
      padding:12px 24px;
      background:white; color:#2cb742;
      border:none; border-radius:8px;
      font-size:16px; cursor:pointer;
      font-weight:bold;
    }

    /* Game layout */
    #game { flex:1; display:flex; }

    .bank-panel {
      flex:2; background:#fff; padding:20px;
      border-right:2px solid #ddd; display:flex; flex-direction:column;
    }
    .header { display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;}
    .scoreboard, .timer {
      font-size:16px; font-weight:bold; padding:5px 10px; border-radius:6px;
    }
    .scoreboard { color:#1e7e34; background:#e6f4ea;}
    .timer { color:#0056b3; background:#e1ecf9;}

    .section { background:#f9fbfd; border:1px solid #ddd; border-radius:8px; padding:12px; margin-bottom:15px; }
    h3 { margin:0 0 10px 0; font-size:16px; color:#2c3e50; }
    label { display:block; font-size:13px; margin-top:5px;}
    input, select {
      width:100%; padding:7px; border:1px solid #aaa; border-radius:5px;
      font-size:14px; box-sizing:border-box; margin-bottom:5px;
    }
    button {
      background:#2cb742; color:white; border:none; border-radius:5px;
      padding:7px 12px; cursor:pointer; font-weight:500; margin-top:4px;
    }
    button:hover{ background:#209834; }

    .account-list { max-height:200px; overflow-y:auto; }
    .account-card { background:#fff; border:1px solid #ddd; border-radius:6px;
      padding:8px; margin-bottom:6px; font-size:14px; }

    .chat-panel { flex:1; background:#f0f5f0; display:flex; flex-direction:column; border-left:2px solid #ccc;}
    .chat-header{ background:#2cb742; padding:10px; font-weight:bold; color:white;}
    .chat-messages{flex:1; padding:12px; overflow-y:auto; display:flex; flex-direction:column;}
    .message{max-width:70%; padding:9px 12px; border-radius:14px; margin:5px 0; font-size:14px;}
    .customer{background:#fff; align-self:flex-start; border:1px solid #ccc;}
    .clerk{background:#dcf8c6; align-self:flex-end;}
    .chat-input{display:flex; padding:10px; border-top:1px solid #ccc; background:#fff;}
    .chat-input input{flex:1; padding:10px; border:1px solid #aaa; border-radius:20px; font-size:14px; margin-right:6px;}
    .chat-input button{width:40px; height:40px; border-radius:50%; font-size:18px; background:#2cb742; color:white;}
  </style>
</head>
<body>

  <!-- Instructions -->
  <div id="instructions">
    <h1>Bank Clerk Training Simulator</h1>
    <p>Welcome! You are the clerk at our virtual bank. Customers will chat with you and request actions.</p>
    <ul>
      <li>Create accounts with the exact Name / Deposit / PIN they provide.</li>
      <li>Handle Deposits, Withdrawals, Transfers — always verifying account exists and PIN matches.</li>
      <li>New feature: Customers may ask you to <b>Delete an Account</b>. Enter the ID and PIN to confirm.</li>
      <li>You earn +10 points for correct actions, lose −5 for mistakes.</li>
      <li>The simulation is endless, see how long you can last!</li>
    </ul>
    <button onclick="startGame()">Start Game</button>
  </div>

  <!-- Game -->
  <div id="game" class="hidden">

    <div class="bank-panel">
      <div class="header">
        <h2>Clerk Dashboard</h2>
        <div class="scoreboard">Score: <span id="score">0</span></div>
        <div class="timer">Time: <span id="timer">00:00</span></div>
      </div>

      <!-- Create Account -->
      <div class="section">
        <h3>Create Account</h3>
        <label>Name:</label><input type="text" id="acctName">
        <label>Initial Deposit:</label><input type="number" id="acctDeposit">
        <label>PIN:</label><input type="password" id="acctPin">
        <button onclick="createAccount()">Create</button>
      </div>

      <!-- Transactions -->
      <div class="section">
        <h3>Transaction</h3>
        <label>Account ID:</label><input type="text" id="tranId">
        <label>Type:</label>
        <select id="tranType">
          <option value="deposit">Deposit</option>
          <option value="withdraw">Withdraw</option>
          <option value="transfer">Transfer</option>
          <option value="delete">Delete Account</option>
        </select>
        <label>Amount:</label><input type="number" id="tranAmount">
        <div id="transferTargetGroup" style="display:none;">
          <label>To Account ID:</label><input type="text" id="tranTarget">
        </div>
        <label>PIN:</label><input type="password" id="tranPin">
        <button onclick="processTransaction()">Submit</button>
      </div>

      <!-- Account List -->
      <div class="section">
        <h3>Accounts</h3>
        <div class="account-list" id="accountList"></div>
      </div>
    </div>

    <div class="chat-panel">
      <div class="chat-header">Customer Chat</div>
      <div class="chat-messages" id="chatMessages"></div>
      <div class="chat-input">
        <input type="text" id="chatInput" placeholder="Type a response...">
        <button onclick="sendMessage()">➤</button>
      </div>
    </div>
  </div>

<script>
  let accounts = [];
  let accountId=1;
  let score=0;
  let currentRequest=null;
  let startTime=0;
  let timerInterval;

  function startGame(){
    document.getElementById("instructions").classList.add("hidden");
    document.getElementById("game").classList.remove("hidden");
    startTime=Date.now();
    timerInterval=setInterval(updateTimer,1000);
    nextRequest();
  }

  function updateTimer(){
    let elapsed=Math.floor((Date.now()-startTime)/1000);
    let m=String(Math.floor(elapsed/60)).padStart(2,'0');
    let s=String(elapsed%60).padStart(2,'0');
    document.getElementById("timer").textContent=`${m}:${s}`;
  }

  function renderAccounts(){
    const list=document.getElementById("accountList");
    list.innerHTML=accounts.map(a=>`<div class="account-card">
       <strong>ID:</strong>${a.id}<br><strong>Name:</strong>${a.name}<br><strong>Balance:</strong>₹${a.balance}
    </div>`).join("");
  }
  function updateScore(p){ score+=p; document.getElementById("score").textContent=score; }

  // --- Request Generator ---
  function generateRequest(){
    const names=["Rahul Sharma","Anjali Verma","Sita Mishra","Rohan Gupta","Arjun Mehta","Kavya Kapoor","Pooja Rao"];
    if(accounts.length===0||Math.random()<0.25){
      let name=names[Math.floor(Math.random()*names.length)]+" #"+Math.floor(Math.random()*1000);
      let deposit=Math.floor(Math.random()*9000)+1000;
      let pin=(""+Math.floor(1000+Math.random()*9000));
      return {type:"create",name,deposit,pin,msg:`Open account. Name: ${name}, Deposit: ₹${deposit}, PIN:${pin}`};
    }
    let acc=accounts[Math.floor(Math.random()*accounts.length)];
    let r=Math.random();
    if(r<0.25){ return {type:"deposit",id:acc.id,amount:1000,pin:acc.pin,msg:`Deposit ₹1000 in A/c ${acc.id}. PIN:${acc.pin}`}; }
    else if(r<0.5){ return {type:"withdraw",id:acc.id,amount:500,pin:acc.pin,msg:`Withdraw ₹500 from A/c ${acc.id}. PIN:${acc.pin}`}; }
    else if(r<0.75 && accounts.length>1){ 
      let to=accounts.find(a=>a.id!==acc.id);
      return {type:"transfer",id:acc.id,target:to.id,amount:400,pin:acc.pin,msg:`Transfer ₹400 from A/c ${acc.id} to A/c ${to.id}. PIN:${acc.pin}`}; }
    else { return {type:"delete",id:acc.id,pin:acc.pin,msg:`Please delete my account ID ${acc.id}. PIN:${acc.pin}`}; }
  }

  function nextRequest(){ currentRequest=generateRequest(); setTimeout(()=>addChatMessage(currentRequest.msg,"customer"),800); }

  function createAccount(){
    const name=document.getElementById("acctName").value;
    const deposit=parseFloat(document.getElementById("acctDeposit").value);
    const pin=document.getElementById("acctPin").value;
    if(!currentRequest||currentRequest.type!=="create"){ addChatMessage("❌ No account creation expected.","clerk"); updateScore(-5); return;}
    if(name===currentRequest.name&&deposit===currentRequest.deposit&&pin===currentRequest.pin){
      accounts.push({id:accountId++,name,balance:deposit,pin});
      renderAccounts(); addChatMessage("✅ Account created.","clerk"); updateScore(10); nextRequest();
    } else{ addChatMessage("❌ Wrong details.","clerk"); updateScore(-5);}
  }

  function processTransaction(){
    const id=parseInt(document.getElementById("tranId").value);
    const type=document.getElementById("tranType").value;
    const amt=parseFloat(document.getElementById("tranAmount").value);
    const pin=document.getElementById("tranPin").value;
    const targetId=parseInt(document.getElementById("tranTarget").value);
    let acc=accounts.find(a=>a.id===id);
    if(!acc){ addChatMessage("❌ Source account not found.","clerk"); updateScore(-5); return;}
    if(acc.pin!==pin){ addChatMessage("❌ Invalid PIN.","clerk"); updateScore(-5); return;}
    let req=currentRequest;

    if(type==="deposit" && req.type==="deposit" && id===req.id && amt===req.amount){ acc.balance+=amt; addChatMessage("✅ Deposit done.","clerk"); updateScore(10); renderAccounts(); nextRequest(); }
    else if(type==="withdraw" && req.type==="withdraw" && id===req.id && amt===req.amount){ if(acc.balance>=amt){acc.balance-=amt; addChatMessage("✅ Withdraw done.","clerk"); updateScore(10); renderAccounts(); nextRequest();} else{addChatMessage("❌ Insufficient.","clerk"); updateScore(-5);} }
    else if(type==="transfer" && req.type==="transfer" && id===req.id && amt===req.amount && targetId===req.target){
      let tgt=accounts.find(a=>a.id===targetId);
      if(!tgt){ addChatMessage("❌ Target acc missing.","clerk"); updateScore(-5); return;}
      if(acc.balance>=amt){acc.balance-=amt; tgt.balance+=amt; addChatMessage("✅ Transfer done.","clerk"); updateScore(10); renderAccounts(); nextRequest();} else { addChatMessage("❌ Insufficient.","clerk"); updateScore(-5);}
    }
    else if(type==="delete" && req.type==="delete" && id===req.id){ 
      accounts=accounts.filter(a=>a.id!==id);
      renderAccounts(); addChatMessage("✅ Account deleted.","clerk"); updateScore(10); nextRequest(); }
    else { addChatMessage("❌ Wrong details/action.","clerk"); updateScore(-5);}
  }

  function sendMessage(){ const i=document.getElementById("chatInput"); if(i.value.trim()!==""){ addChatMessage(i.value,"clerk"); i.value=""; } }
  function addChatMessage(t,s){ const m=document.getElementById("chatMessages"); let d=document.createElement("div"); d.className="message "+s; d.textContent=t; m.appendChild(d); m.scrollTop=m.scrollHeight; }

  document.getElementById("tranType").addEventListener("change",function(){
    document.getElementById("transferTargetGroup").style.display=this.value==="transfer"?"block":"none";
  });
</script>
</body>
</html>
