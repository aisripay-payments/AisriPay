<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AISRIPAY - WhatsApp & GPay/Paytm Style</title>
<link rel="icon" href="https://iili.io/K1llYMu.png" />
<style>
  *, *::before, *::after {
    box-sizing: border-box;
  }
  body {
    margin: 0; padding: 0;
    font-family: 'Product Sans', Arial, sans-serif;
    background: #e5ddd5;
    color: #000;
  }
  #app {
    max-width: 400px;
    margin: 0 auto;
    min-height: 100vh;
    position: relative;
    background: white;
    display: flex;
    flex-direction: column;
  }
  header {
    background: #128c7e;
    color: #fff;
    padding: 16px 20px;
    font-weight: 600;
    font-size: 20px;
    box-shadow: 0 1px 3px rgb(0 0 0 / 0.15);
    display: flex;
    justify-content: flex-start;
    align-items: center;
    gap: 14px;
  }
  header img.logo {
    width: 32px;
    height: 32px;
  }
  header .title {
    font-weight: 700;
    font-size: 22px;
    user-select: none;
  }
  .user-info {
    margin-left: auto;
    text-align: right;
    user-select: none;
  }
  .user-info span {
    display: block;
  }
  .user-info .name {
    font-weight: 700;
  }
  main {
    flex-grow: 1;
    padding: 24px 20px 88px;
    background: #f5f5f5;
  }
  main h2 {
    font-weight: 700;
    color: #075e54;
    margin-bottom: 16px;
  }
  main p {
    font-size: 16px;
    margin-bottom: 12px;
  }
  main input, main button {
    width: 100%;
    font-size: 16px;
    padding: 14px 18px;
    margin-bottom: 16px;
    border-radius: 22px;
    border: none;
    outline: none;
  }
  main input {
    border: 1.5px solid #ccc;
  }
  main input:focus {
    border-color: #128c7e;
    box-shadow: 0 0 8px #128c7eaa;
  }
  main button {
    background: linear-gradient(90deg, #1a73e8, #4285f4);
    color: white;
    font-weight: 700;
    cursor: pointer;
    box-shadow: 0 5px 15px rgba(26, 115, 232, 0.6);
    transition: box-shadow 0.3s ease;
    border:none;
  }
  main button:hover {
    box-shadow: 0 7px 22px rgba(26, 115, 232, 0.85);
  }
  .msg {
    font-size: 14px;
    min-height: 21px;
    text-align: center;
    margin-bottom: 12px;
  }
  .msg.red {
    color: #cc0000;
  }
  .msg.green {
    color: #01875f;
  }
  nav.bottom-nav {
    position: fixed;
    bottom: 0;
    width: 100%;
    max-width: 400px;
    height: 58px;
    background: #ffffff;
    border-top: 1px solid #ccc;
    display: flex;
    justify-content: space-around;
    align-items: center;
    box-shadow: 0 -2px 6px rgb(0 0 0 / 0.10);
    z-index: 3;
  }
  nav.bottom-nav button {
    background: none;
    border: none;
    color: #128c7e;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    padding: 8px 10px;
    border-radius: 14px;
    transition: background-color 0.25s ease;
    user-select: none;
  }
  nav.bottom-nav button.active {
    background: #128c7e;
    color: white;
    box-shadow: 0 4px 10px rgba(18,140,126,0.6);
  }
  nav.bottom-nav button:hover:not(.active) {
    background: #ccf1ee;
  }
  .fab {
    position: fixed;
    bottom: 44px;
    left: 50%;
    transform: translateX(-50%);
    width: 66px;
    height: 66px;
    background: #128c7e;
    border-radius: 50%;
    box-shadow: 0 5px 22px rgba(18, 140, 126, 0.75);
    color: white;
    font-size: 34px;
    font-weight: 900;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    z-index: 5;
    transition: box-shadow 0.3s ease;
    user-select: none;
  }
  .fab:hover {
    box-shadow: 0 8px 32px rgba(18, 140, 126, 1);
  }
  #signup-info {
    font-size: 12px;
    color: #128c7e;
    line-height: 1.3;
    text-align: center;
  }
</style>
</head>
<body>
  <div id="app">
    <header>
      <img class="logo" src="https://iili.io/K1llYMu.png" alt="AISRIPAY" />
      <div class="title">AISRIPAY</div>
      <div class="user-info">
        <span class="name" id="topName">Welcome</span>
        <span id="topID"></span>
      </div>
    </header>
    <main id="mainContent"></main>
    <nav class="bottom-nav">
      <button id="navHome" class="active" onclick="showHome()">Home</button>
      <button id="navPay" onclick="showPay()">Pay</button>
      <button id="navDetails" onclick="showDetails()">Details</button>
      <button id="navSettings" onclick="showSettings()">Settings</button>
      <button id="navLogout" onclick="logout()">Logout</button>
    </nav>
    <div class="fab" onclick="showPay()">₹→</div>
  </div>

<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbwobOBgxtikpW6Akx88a6M9qrmr9NS8tUVdnreTP18abOuXxA_0ftzJ0h26BWQ1fXE-/exec";
  const API_SECRET = "qwe789asd456zxc123qwe456asd123zxc789qaz789wsx456edc123";

  let currentUser = null;

  function setActiveNav(id) {
    ["navHome", "navPay", "navDetails", "navSettings", "navLogout"].forEach(btnId => {
      document.getElementById(btnId).classList.remove("active");
    });
    if (document.getElementById(id)) {
      document.getElementById(id).classList.add("active");
    }
  }

  function showHome() {
    if (!currentUser) {
      showLogin();
      return;
    }
    setActiveNav("navHome");
    document.getElementById("topName").textContent = currentUser.name;
    document.getElementById("topID").textContent = "ID: " + currentUser.id;
    document.getElementById("mainContent").innerHTML = `
      <h2>Balance</h2>
      <div style="font-size: 32px; font-weight: 700; color: #128c7e; margin-bottom: 20px;">₹${currentUser.balance}</div>
      <p>Welcome back, <strong>${currentUser.name}</strong>!</p>
      <p>Use the Pay tab or the floating button below to send money quickly.</p>
    `;
  }

  function showPay() {
    if (!currentUser) {
      showLogin();
      return;
    }
    setActiveNav("navPay");
    document.getElementById("mainContent").innerHTML = `
      <h2>Send Money</h2>
      <input type="text" id="payID" maxlength="8" placeholder="Recipient User ID" />
      <input type="number" id="payAmt" placeholder="Amount (₹)" />
      <button onclick="confirmPay()">Confirm & Pay</button>
      <div id="payMsg" class="msg"></div>
    `;
  }

  function showDetails() {
    if (!currentUser) {
      showLogin();
      return;
    }
    setActiveNav("navDetails");
    document.getElementById("mainContent").innerHTML = `
      <h2>Profile Details</h2>
      <p><strong>Name:</strong> ${currentUser.name}</p>
      <p><strong>User ID:</strong> ${currentUser.id}</p>
      <p><strong>Email:</strong> ${currentUser.email}</p>
      <p><strong>Phone:</strong> ${currentUser.phone}</p>
      <p><strong>Date of Birth:</strong> ${currentUser.dob}</p>
    `;
  }

  function showSettings() {
    if (!currentUser) {
      showLogin();
      return;
    }
    setActiveNav("navSettings");
    document.getElementById("mainContent").innerHTML = `
      <h2>Change PIN</h2>
      <input maxlength="4" id="oldPin" type="password" placeholder="Old PIN" />
      <input maxlength="4" id="newPin" type="password" placeholder="New PIN" />
      <button onclick="changePin()">Change PIN</button>
      <div id="settingMsg" class="msg"></div>
    `;
  }

  function logout() {
    currentUser = null;
    clearUI();
    showLogin();
  }

  function clearUI() {
    document.getElementById("topName").textContent = "Welcome";
    document.getElementById("topID").textContent = "";
    document.getElementById("mainContent").innerHTML = "";
    setActiveNav("");
  }

  function showLogin() {
    clearUI();
    setActiveNav("");
    document.getElementById("app").style.background = "#e5ddd5";
    document.getElementById("topName").textContent = "Please Login";
    document.getElementById("topID").textContent = "";
    document.getElementById("mainContent").innerHTML = `
      <input type="text" id="loginID" maxlength="8" placeholder="8-digit User ID" />
      <input type="password" id="loginPIN" maxlength="4" placeholder="4-digit PIN" />
      <button onclick="login()">Login</button>
      <button onclick="showSignup()" style="margin-top: 10px; width: 100%; border-radius: 22px; padding: 16px 0; font-weight: 600; background: #128c7e; color: white; border: none; cursor: pointer;">Sign Up</button>
      <div id="loginMsg" class="msg"></div>
      <div id="signup-info" style="font-size: 12px; color: #128c7e; text-align: center; margin-top: 20px; line-height: 1.3;">
        New user? Email <br />
        <a href="mailto:aisripay.payments@gmail.com" style="color: #0b5c43; text-decoration: underline;">aisripay.payments@gmail.com</a><br />
        with your Banking Name, Email, Phone, DOB & ID Proof (Aadhaar, PAN, DL)<br />
        Or visit an AISRIPAY Shop to register.
      </div>
    `;
  }

  function showSignup() {
    clearUI();
    setActiveNav("");
    document.getElementById("app").style.background = "white";
    document.getElementById("topName").textContent = "Sign Up Instructions";
    document.getElementById("topID").textContent = "";
    document.getElementById("mainContent").innerHTML = `
      <p style="font-size: 14px; color: #3c4043; text-align: center; padding: 0 12px;">
        To create an account, email:<br />
        <strong>aisripay.payments@gmail.com</strong><br />
        your Banking Name, Email ID, Phone Number, DOB,<br />
        and valid ID proof (Aadhaar, PAN, Driving License).<br />
        Or visit an AISRIPAY Shop to register.<br />
        You will receive your User ID & PIN after verification.
      </p>
      <button onclick="showLogin()" style="margin-top: 20px; width: 100%; border-radius: 22px; padding: 16px 0; font-weight: 600; background: #128c7e; color: white; border: none; cursor: pointer;">Back to Login</button>
    `;
  }

  async function login() {
    const id = document.getElementById("loginID").value.trim();
    const pin = document.getElementById("loginPIN").value.trim();
    if (!id || !pin) return showMsg("loginMsg", "Please enter User ID & PIN", "red");
    const res = await apiPost({ action: "login", id, pin });
    if (res.success) {
      currentUser = res.data;
      document.getElementById("app").style.background = "white";
      showHome();
    } else showMsg("loginMsg", res.message, "red");
  }

  async function confirmPay() {
    const toID = document.getElementById("payID").value.trim();
    const amt = document.getElementById("payAmt").value.trim();
    if (!toID || !amt) return showMsg("payMsg", "Enter recipient ID & amount", "red");
    const res = await apiPost({ action: "transfer", fromID: currentUser.id, toID, amount: amt });
    if (res.success) {
      showMsg("payMsg", "Payment successful!", "green");
      const profile = await apiPost({ action: "getProfile", id: currentUser.id });
      if (profile.success) currentUser = profile.data;
      setTimeout(() => showHome(), 1600);
    } else showMsg("payMsg", res.message, "red");
  }

  async function changePin() {
    const oldPin = document.getElementById("oldPin").value.trim();
    const newPin = document.getElementById("newPin").value.trim();
    if (!oldPin || !newPin) return showMsg("settingMsg", "Both old & new PIN are required", "red");
    const res = await apiPost({ action: "changePin", id: currentUser.id, oldPin, newPin });
    if (res.success) {
      showMsg("settingMsg", "PIN changed successfully. Please login again.", "green");
      setTimeout(() => {
        currentUser = null;
        showLogin();
      }, 1600);
    } else showMsg("settingMsg", res.message, "red");
  }

  async function logout() {
    currentUser = null;
    showLogin();
  }

  async function apiPost(payload) {
    payload.apiSecret = API_SECRET;
    try {
      const res = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });
      return await res.json();
    } catch {
      return { success: false, message: "Unable to connect to server." };
    }
  }

  function showMsg(id, text, cls) {
    const el = document.getElementById(id);
    if (el) el.innerHTML = `<span class="${cls}">${text}</span>`;
  }

  window.onload = () => {
    showLogin();
  };
</script>
</body>
</html>
